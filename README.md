Heroku Jenkins Plugin
======================

A plugin for interacting with [Heroku](http://heroku.com) during [Jenkins](http://jenkins-ci.org/) builds.
Currently, the only exposed functionality is WAR deployment, which can be used to deploy WAR artifacts to Heroku.

Installing
----------

This plugin is not yet in the Jenkins plugin directory and must be installed manually:

1. Download the latest version from the [downloads](https://github.com/heroku/heroku-jenkins-plugin/downloads) tab
2. In your Jenkins instance, go to Manage Jenkins | Manage Plugins | Advanced | Upload Plugin
3. Choose the file you downloaded and click upload
4. Restart Jenkins

Configuration
-------------

The Heroku API key used by build steps can be configured either with a global default or for individual build steps.
To configure a global default API key, go to Manage Jenkins | Heroku | Default API Key. This key will be used
by Heroku build steps unless otherwise overridden. If no global default is specified, individual build steps must specify
their own API keys. Your Heroku API key can be obtained from your [Heroku account page](https://api.heroku.com/account).

WAR Deployment
--------------

The `Deploy WAR Artifact` build step allows you to deploy a WAR file generated by your build directly to a Heroku app.

To deploy a WAR file, first make sure your build is successfully creating a deployable WAR file.
If you are using Maven with `<packaging>war</packaging>`, the `mvn package` command will output the WAR file into its `target` directory.
Otherwise, create the WAR file in whatever way is approiate for your build.

After the WAR file is created, add the `Heroku: Deploy WAR Artifact` build step to your under the Jenkins build configuration and complete the fields:

 - API Key: Your Heroku API key to use for deployment. This is only required if a global default is not already configured. Your Heroku API key can be obtained from your [Heroku account page](https://api.heroku.com/account).
 - App Name: The app to which to deploy. If the app exists, you must have access to deploy new releases. If the app does not exist and the name is not already taken, it will be created for you.
 - WAR Path: The relative path to the WAR file created in a previous build step to deploy.

When the build runs, the WAR file will be uploaded and deployed to Heroku.

Building from Source
--------------------

1. Follow instructions on [setting up your environment](https://wiki.jenkins-ci.org/display/JENKINS/Plugin+tutorial#Plugintutorial-SettingUpEnvironment)
   from Jenkins

2. This plugin has a dependency on [direct-to-heroku-client](https://github.com/heroku/direct-to-heroku-client-java),
   which is not yet in Maven central. To build this plugin, you must first build the client from source:

     `git clone git://github.com/heroku/direct-to-heroku-client-java.git`

     `mvn clean install -DskipTests`

3. Build the plugin:

     `git clone git://github.com/heroku/heroku-jenkins-plugin.git`

     `mvn clean package -DskipTests`

     or with tests:

     `mvn clean package -Dheroku.apiKey="<test user api key>" -Dheroku.appName="<test app>"`

4. This will create a `*.hpi` file in the `target` directory. Install this in Jenkins as expained above.